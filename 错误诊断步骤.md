# 🔍 错误诊断步骤

## ❓ 如果仍然看到错误

请按照以下步骤诊断问题：

### 步骤 1: 确认部署已完成

1. **检查 Vercel 部署状态**
   - 访问 [Vercel Dashboard](https://vercel.com/dashboard)
   - 进入项目 → **Deployments**
   - 确认最新部署状态为 **Ready**（绿色）
   - 确认部署时间是最新的（刚刚完成）

2. **如果部署未完成**
   - 等待部署完成（通常 1-3 分钟）
   - 或手动触发重新部署

### 步骤 2: 查看详细日志

1. **在 Vercel Dashboard 中**
   - 进入项目 → **Deployments** → 最新部署
   - 点击 **Functions** 标签
   - 查看函数日志

2. **查找关键日志**

#### 应该看到的日志：

**成功的情况**：
```
✅ GOOGLE_API_KEY is configured (format looks correct)
📋 Found X available models: gemini-2.5-flash, gemini-2.5-pro-exp, ...
🔍 Will try X models: gemini-2.5-flash, gemini-2.5-pro-exp, ...
🔄 Trying: gemini-2.5-flash with API v1beta
✅ Successfully used Gemini model: gemini-2.5-flash with API v1beta
```

**失败的情况**：
```
🔄 Trying: gemini-2.5-flash with API v1beta
⚠️ Model gemini-2.5-flash with API v1beta not found (404), trying next...
🔄 Trying: gemini-2.5-pro-exp with API v1beta
...
```

### 步骤 3: 检查具体错误信息

请告诉我你看到的具体错误信息：

1. **错误消息是什么？**
   - 是 "All Gemini models and API versions failed"？
   - 还是其他错误消息？

2. **错误代码是什么？**
   - 404 Not Found？
   - 429 Too Many Requests？
   - 401 Unauthorized？
   - 其他？

3. **在哪个步骤失败？**
   - 查询模型列表时？
   - 调用生成内容时？
   - 其他？

### 步骤 4: 验证模型名称

根据 Google 后台显示，可用的模型是：
- `gemini-2.5-flash`
- `gemini-2.5-pro-exp`

**请确认**：
- 这些模型名称是否完全正确？
- 是否有大小写问题？
- 是否需要不同的格式？

### 步骤 5: 手动测试 API

使用 curl 测试 API 是否工作：

```bash
curl -X POST \
  "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "contents": [{
      "parts": [{
        "text": "Hello"
      }]
    }]
  }'
```

**替换 `YOUR_API_KEY` 为你的实际 API 密钥**

如果这个命令成功，说明模型名称和 API 密钥都正确。

### 步骤 6: 清除缓存（如果需要）

如果代码已更新但似乎还在使用旧逻辑：

1. **清除 Vercel 缓存**
   - 在 Vercel Dashboard 中
   - 进入项目 → **Settings** → **General**
   - 找到 **Clear Build Cache**（清除构建缓存）
   - 点击清除

2. **重新部署**
   - 手动触发重新部署
   - 等待完成

### 步骤 7: 强制使用特定模型

如果想强制使用 `gemini-2.5-flash`：

1. **在 Vercel 环境变量中设置**
   - **Name**: `GEMINI_MODEL`
   - **Value**: `gemini-2.5-flash`
   - **Environment**: 所有环境

2. **重新部署**
   - 保存环境变量后
   - 手动触发重新部署

## 📋 需要提供的信息

为了帮助诊断，请提供：

1. **具体的错误消息**（完整文本）
2. **Vercel 日志截图**（特别是函数日志）
3. **错误发生的时间**（是否在部署后立即发生）
4. **测试的端点**（哪个工具页面）
5. **手动测试 API 的结果**（如果测试了）

## 🔧 快速修复尝试

### 方法 1: 强制使用 gemini-2.5-flash

1. 在 Vercel 环境变量中添加：
   ```
   GEMINI_MODEL=gemini-2.5-flash
   ```
2. 重新部署

### 方法 2: 检查 API 版本

代码会尝试 `v1beta` 和 `v1`。如果 `v1beta` 不工作，会自动尝试 `v1`。

### 方法 3: 查看实际使用的模型

在 Vercel 日志中查找：
- `🔄 Trying: ...` - 显示正在尝试的模型
- `✅ Successfully used Gemini model: ...` - 显示成功使用的模型
- `⚠️ Model ... not found` - 显示失败的模型

## 💡 常见问题

### Q: 为什么更新后还是旧错误？

**A**: 可能是：
- 部署还未完成
- 缓存问题
- 需要清除构建缓存并重新部署

### Q: 模型名称是否正确？

**A**: 根据你提供的信息，应该是：
- `gemini-2.5-flash`（不是 `gemini-2.5-flash-latest`）
- `gemini-2.5-pro-exp`（注意是 `-exp` 后缀）

### Q: 如何确认代码已更新？

**A**: 查看 Vercel 日志，应该看到：
- `🔍 Will try X models: ...`（新增的日志）
- `🔄 Trying: ...`（新增的日志）

如果看不到这些日志，说明代码可能还未更新。

---

**请提供具体的错误信息，这样我可以更准确地帮你解决问题！** 🔍

