# 🔍 404 错误诊断指南

## ❌ 问题：Function Invocation 404 Not Found

如果看到以下日志：
```
Function Invocation
404
Not Found
External APIs
No outgoing requests
```

这表示请求没有到达你的 Express 应用，或者路由配置有问题。

## 🔍 诊断步骤

### 步骤 1: 测试 API 路由是否工作

部署后，测试以下端点：

#### 测试 1: 健康检查端点
```
GET https://your-domain.vercel.app/api/health
```

**预期响应**:
```json
{
  "status": "ok",
  "timestamp": "2024-..."
}
```

#### 测试 2: 测试端点
```
GET https://your-domain.vercel.app/api/test
```

**预期响应**:
```json
{
  "status": "ok",
  "message": "API routing is working",
  "path": "/test",
  "method": "GET",
  "timestamp": "2024-..."
}
```

#### 测试 3: POST 测试端点
```
POST https://your-domain.vercel.app/api/test
Content-Type: application/json

{}
```

**预期响应**:
```json
{
  "status": "ok",
  "message": "API POST routing is working",
  "path": "/test",
  "method": "POST",
  "body": {},
  "timestamp": "2024-..."
}
```

### 步骤 2: 检查 Vercel 路由配置

确认 `vercel.json` 配置正确：

```json
{
  "version": 2,
  "builds": [
    {
      "src": "server.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/server.js"
    },
    {
      "src": "/(.*)",
      "dest": "/server.js"
    }
  ]
}
```

### 步骤 3: 查看 Vercel 函数日志

1. 在 Vercel Dashboard 中
2. 进入项目 → **Deployments**
3. 点击最新部署
4. 进入 **Functions** 标签
5. 查看日志，寻找：
   - `📡 API Request: POST /api/tools/tiktok-title` - 说明请求到达了
   - `📝 TikTok Title API called` - 说明路由匹配成功
   - `⚠️ API request reached catch-all route` - 说明路由有问题

### 步骤 4: 检查浏览器控制台

1. 打开你的网站
2. 打开浏览器开发者工具（F12）
3. 进入 **Network**（网络）标签
4. 尝试使用工具
5. 查看请求：
   - **URL**: 应该是 `/api/tools/tiktok-title`
   - **Method**: 应该是 `POST`
   - **Status**: 查看状态码
   - **Response**: 查看响应内容

## 🐛 常见问题和解决方案

### 问题 1: 所有 API 端点都返回 404

**可能原因**:
- Vercel 路由配置不正确
- `server.js` 没有正确导出
- 函数没有正确构建

**解决方案**:
1. 检查 `vercel.json` 配置
2. 确认 `server.js` 正确导出 Express 应用
3. 查看 Vercel 构建日志，确认没有构建错误

### 问题 2: 健康检查工作，但工具 API 不工作

**可能原因**:
- 路由路径不匹配
- 请求方法不对（GET vs POST）

**解决方案**:
1. 检查前端调用的路径是否正确
2. 确认 API 路由定义的方法（POST）与前端调用一致
3. 查看日志确认请求是否到达

### 问题 3: 看到 "API request reached catch-all route"

**含义**: API 请求被 catch-all 路由拦截了

**解决方案**:
- 这不应该发生，说明 API 路由没有正确匹配
- 检查路由顺序和路径匹配

### 问题 4: 没有看到任何日志

**可能原因**:
- 请求根本没有到达 Vercel 函数
- Vercel 路由配置有问题

**解决方案**:
1. 检查 Vercel 路由配置
2. 确认部署成功
3. 尝试直接访问 API 端点（使用 curl 或 Postman）

## 🔧 手动测试 API

### 使用 curl

```bash
# 测试健康检查
curl https://your-domain.vercel.app/api/health

# 测试工具 API
curl -X POST https://your-domain.vercel.app/api/tools/tiktok-title \
  -H "Content-Type: application/json" \
  -d '{"topic":"test","tone":"engaging","style":"trendy"}'
```

### 使用浏览器

直接访问：
```
https://your-domain.vercel.app/api/health
```

应该看到 JSON 响应。

## 📋 检查清单

完成以下检查：

- [ ] `vercel.json` 配置正确
- [ ] `server.js` 正确导出 Express 应用
- [ ] API 路由定义正确
- [ ] `/api/health` 端点可以访问
- [ ] `/api/test` 端点可以访问
- [ ] 查看 Vercel 日志，确认请求到达
- [ ] 浏览器控制台没有 CORS 错误
- [ ] 网络请求显示正确的 URL 和方法

## 🎯 快速修复

如果所有测试端点都返回 404：

1. **检查部署状态**
   - 确认部署成功
   - 查看构建日志是否有错误

2. **验证路由配置**
   - 确认 `vercel.json` 中的路由配置正确
   - 确认 `/api/(.*)` 路由到 `server.js`

3. **重新部署**
   - 手动触发重新部署
   - 等待部署完成

4. **测试端点**
   - 先测试 `/api/health`
   - 再测试 `/api/test`
   - 最后测试工具 API

## 📞 需要帮助？

如果以上步骤都无法解决问题：

1. **查看完整日志**
   - Vercel 函数日志
   - 浏览器控制台
   - 网络请求详情

2. **提供信息**
   - 测试端点的响应
   - Vercel 日志截图
   - 浏览器网络请求详情

3. **联系支持**
   - [Vercel 支持](https://vercel.com/support)
   - 查看 [Vercel 文档](https://vercel.com/docs)

---

**记住**: 404 错误通常意味着路由配置问题，而不是代码逻辑问题。检查 Vercel 路由配置和 API 端点路径！

